# 로봇공학 OJT 학습 가이드

이 파일은 로봇공학 학습 진행 상황과 내용을 기록합니다.

---

## 학습 환경

| 항목 | 경로 |
|------|------|
| **학습 폴더** | `C:\share\Dev\Robotics_Learning` |
| **참고 자료** | `C:\share\Dev\Robotics_Learning\ref` (HCR 로봇 OJT 원본) |
| **시작일** | 2026-02-05 |
| **목표** | 2-Link 로봇부터 시작해 로봇 매니퓰레이터 이론 완전 이해 |

---

## 폴더 구조

```
Robotics_Learning/
├── 2_link/              ← 2축 로봇 (현재 학습)
├── 6_link/              ← 6축 로봇 (나중에)
├── lib/                 ← 공통 함수
├── ref/                 ← OJT 참고자료 (거의 안 봄)
└── README.md
```

## 학습 진행 (2_link)

| 파일 | 카테고리 | 내용 | 상태 |
|------|---------|------|------|
| `s01_basics_robot.m` | basics | 로봇 정의, 자세, workspace | ✅ |
| `s02_basics_fk.m` | basics | FK: 각도 → 위치 | ✅ |
| `s03_basics_ik.m` | basics | IK: 위치 → 각도 | ✅ |
| `s04_kinematics_dh.m` | kinematics | DH 파라미터, 변환 행렬 | ✅ |
| `s05_kinematics_jacobian.m` | kinematics | 자코비안, 특이점 | ✅ |
| `s06_dynamics_basics.m` | dynamics | 토크 계산, M/C/g, 중력보상 | ✅ |
| `s07_control_basics.m` | control | PD 제어, 중력보상, 게인 튜닝 | ✅ |
| `_animation.m` | 부록 | RVCTools 애니메이션 | ✅ |

---

## 핵심 공식

### 2-Link Forward Kinematics (FK)
```
x = L1*cos(q1) + L2*cos(q1+q2)
y = L1*sin(q1) + L2*sin(q1+q2)
```

### 2-Link Inverse Kinematics (IK)
```
cos(q2) = (x² + y² - L1² - L2²) / (2*L1*L2)
q2 = atan2(±√(1-cos²q2), cos(q2))  ← 해 2개 (elbow up/down)
```

### DH 파라미터
```
| Link | θ    | d  | a   | α   |
|------|------|----|-----|-----|
| 1    | q1   | 0  | L1  | 0   |
| 2    | q2   | 0  | L2  | 0   |

DH 변환 행렬:
T = Rz(θ) * Tz(d) * Tx(a) * Rx(α)
```

### 자코비안 (Jacobian)
```
순방향: ẋ = J(q) * q̇  (이론용)
역방향: q̇ = J⁻¹ * ẋ   (실제 제어용) ⭐

J = | -L1*sin(q1) - L2*sin(q1+q2)   -L2*sin(q1+q2) |
    |  L1*cos(q1) + L2*cos(q1+q2)    L2*cos(q1+q2) |

특이점: det(J) = L1*L2*sin(q2) = 0
       → q2 = 0° 또는 180° (팔 완전히 펴지거나 접힘)
       → 역행렬 계산 불가 → 속도 제어 실패
```

### 제어 (Control)
```
PD + 중력보상 (로봇 제어 표준):
  τ = Kp·e + Kd·ė + g(q)

  e  = q_goal - q     (위치 오차)
  ė  = 0 - qd         (속도 오차)
  Kp = 비례 게인 (스프링, 가스페달)
  Kd = 미분 게인 (댐퍼, 브레이크)
  g(q) = 중력보상 (중력 미리 상쇄)

PID는 일반 모터 제어용, 로봇 팔은 PD+G가 표준
  → I항 대신 g(q)가 정상상태 오차를 직접 해결
```

### 동역학 (Dynamics)
```
핵심 공식: τ = M·q̈ + C·q̇ + g

M: 질량 행렬 (무거우면 힘 더 필요)
C: 코리올리 (회전하면서 생기는 힘, 팔꿈치 빠지는 거 잡기)
g: 중력 토크 (자세별로 다름! 9.81 상수가 아님)

코드:
tau = robot.rne(q, qd, qdd);         % 한방 계산
M = robot.inertia(q);                % M 따로 보기
C = robot.coriolis(q, qd);           % C 따로 보기
g = robot.gravload(q);               % g 따로 보기

역동역학 (ID): 궤적 → 토크 (실무 핵심, 로봇 제어)
순동역학 (FD): 토크 → 궤적 (시뮬레이션용)
```

---

## 학습 노트

### 260209-2 - 제어 기초 (상세)

#### 왜 제어가 필요한가?
- 처음 질문: "s06에서 토크 계산 배웠는데 그걸로 끝 아냐?"
- 현실 문제: 모델 오차, 외란(누가 밀기), 마찰 등
- 비유: 눈 감고 걸어가기(계산만) vs 눈 뜨고 걸어가기(피드백)
- → 피드백 제어 = "지금 어디 있는지 확인하고 보정"

#### PD 제어 이해
- P = 스프링 (Proportional, 비례): 목표에서 멀면 세게 당김
- D = 댐퍼 (Derivative, 미분): 빨리 움직이면 브레이크
- 공식: tau = Kp * (목표-현재) + Kd * (0-속도)

#### PID에서 I항은?
- 처음 질문: "PID 많이 들어봤는데 왜 여기선 PD만?"
- I (Integral, 적분) = 오차가 쌓인 시간에 비례해서 힘 키움
- P=스프링, D=댐퍼 같은 물리 부품 비유가 I에는 없음
- 비유: 에어컨 리모컨 쥔 사람 (시간 지날수록 점점 풍량 올림)
- 로봇에서 I 대신 g(q) 쓰는 이유:
  - I: 오차 원인 모르고 더듬더듬 힘 키움 (느림, 와인드업 위험)
  - g(q): 원인이 중력인 걸 알고 바로 보상 (즉시 해결)
  - 비유: I=물 퍼내기(원인 모름) vs g(q)=구멍 막기(원인 해결)

#### PD only vs PD+중력보상 차이
- 처음 질문: "오차만큼만 힘을 낸다는 게 무슨 말?"
- PD only: 45도까지 가야 하는데 목표 가까이 갈수록 힘이 약해짐
  → 근데 중력은 안 약해짐 → 어느 순간 중력한테 짐 → 43도에서 멈춤
- PD+G: 오차분 힘 + 중력 보상분을 항상 별도로 잡아줌 → 45도 정확 도달
- 핵심: 중력이 없는 우주에서는 PD만으로도 정확! 지구라서 G 필요

#### 끝점 궤적 (End-effector Trajectory)
- 처음 질문: "끝점 궤적이 뭐야?"
- 끝점 = 로봇 맨 끝(손끝) 위치 = FK로 계산한 (x, y)
- 궤적 = 시간에 따라 손끝이 이동한 경로를 X-Y 평면에 그린 것
- 윗줄 그래프는 "관절 각도" 시점, 이건 "실제 공간 위치" 시점

#### 끝점 궤적에서 진동
- 처음 질문: "빨간색 궤적이 x=-0.5까지 갔다 오는데 날라간 거 아냐?"
- 날라가는 게 아님! 스프링처럼 목표 지나쳐서 왔다갔다 하는 것 (오버슈트)
- Kp(스프링)가 세게 당기면 관성 때문에 목표 지나침 → 반대쪽에서 다시 당김 → 진동
- Kd(댐퍼)가 이 진동을 줄여주는 역할

#### Kp/Kd 게인 튜닝 (Figure 2)
- Kp = 가스페달, Kd = 브레이크
- Kp↑: 빨리 도달, 너무 크면 진동 (출렁)
- Kd↑: 진동 없이 안정, 너무 크면 느림
- 트레이드오프! 균형 맞추기 = 게인 튜닝

#### 전체 흐름 업데이트
```
FK:    각도 → 위치           "어디 있지?"
IK:    위치 → 각도           "어떻게 가지?"
J:     관절속도 → 끝점속도    "얼마나 빨리?"
ID:    궤적 → 토크            "얼마의 힘으로?"
제어:  토크 → 정확한 동작     "어떻게 제어?" ← 여기!
```

### 260209 - 동역학 기초 (상세)

#### Kinematics vs Dynamics 구분
- **Kinematics**: 위치, 속도 (힘 없음) → FK, IK, 자코비안
- **Dynamics**: 힘, 토크, 질량 (힘 있음) → 토크 계산
- 한 줄 요약: **힘/토크가 있으면 Dynamics, 없으면 Kinematics**

#### 동역학 핵심 공식
```
τ = M·q̈ + C·q̇ + g
```
- 외울 필요 없음, 개념만 알면 됨
- τ(tau), M(질량), g(중력) 정도만 기억

#### q, qd, qdd의 의미
- q = 관절 각도 (position, rad) ← (x,y) 좌표가 아님!
- qd = 관절 속도 (velocity, rad/s)
- qdd = 관절 가속도 (acceleration, rad/s²)
- d = derivative(미분): q → qd → qdd

#### 코리올리 (C) 이해 과정
- 처음 질문: "M, g는 알겠는데 C는 뭐야?"
- 이해: 어깨를 빠르게 돌리면 팔꿈치가 바깥으로 튀려고 함
- → 그걸 안쪽으로 잡아주는 힘 = 코리올리 보상
- 속도(qd)가 0이면 코리올리도 0, 빠르면 커짐

#### 중력 토크 g(q) 이해 과정
- 처음 질문: "g는 그냥 9.81 아냐? 자세마다 같은 거 아닌가?"
- 핵심: 중력 가속도(9.81) ≠ 중력 토크 g(q)
  - 9.81 = 중력 가속도 (상수, 항상 같음)
  - g(q) = 중력 토크 (자세에 따라 바뀜!)
- 이유: 토크 = 힘 × 수직 거리
  - 수평 자세 → 수직 거리 길다 → 토크 큼
  - 수직 자세 → 수직 거리 0 → 토크 ≈ 0
- 비유: 연필 세우면 안 쓰러짐 (중력이 축 통과), 눕히면 쓰러짐

#### 중력보상 (Gravity Compensation)
- 회사에서 말하는 "중력보상" = g(q)를 계산해서 토크에 더해주는 것
- 안 하면: 중력 때문에 토크 일부가 낭비 → 오차 발생
- 하면: 중력 영향 보상 → 정확한 제어

#### 자세별 토크 (정지 상태)
- 수평 (0°, 0°): 어깨+팔꿈치 둘 다 중력 버텨야 함 → 토크 큼
- 위로 (90°, 0°): 중력과 평행 → 토크 ≈ 0
- 아래로 (-90°, 0°): 반대 방향 토크

#### 역동역학(ID) vs 순동역학(FD)
- ID: 궤적 → 토크 (실무 핵심, 실제 로봇 제어)
- FD: 토크 → 궤적 (시뮬레이션용, 개념만 알면 됨)

#### 전체 흐름 복습
```
FK:  각도 → 위치        "어디 있지?"
IK:  위치 → 각도        "어떻게 가지?"
J:   관절속도 → 끝점속도  "얼마나 빨리?"
ID:  궤적 → 토크         "얼마의 힘으로?"
```

### 260206 - DH 파라미터 & 자코비안 (상세)

#### 폴더 구조 개편
- 기존: `01_2link_basics/`, `02_kinematics/` 등 주제별
- 변경: `2_link/` 하위에 `s01_basics_robot.m`, `s04_kinematics_dh.m` 등
- 이유: 최종 목표가 6-link이므로 로봇 타입별로 구분, 파일명에 카테고리 포함

#### s04_kinematics_dh.m - DH 파라미터

**처음 헷갈렸던 것: "θ가 Z축 회전인데 왜 그림에는 X,Y축만 있어?"**
- Z축은 화면 밖으로 나오는 축 (당신을 향함)
- Z축 기준 회전 = X-Y 평면 내에서의 회전
- 2D 그림은 위에서 내려다본 뷰 (`view(2)`)
- 결론: θ = 30°는 X축에서 30° 돌린 것 = Z축 회전

**DH 파라미터 핵심 (암기 불필요, 개념만)**
1. 4개 파라미터: θ(Z회전), d(Z이동), a(X이동=링크길이), α(X회전=비틀림)
2. Planar Robot: d=0, α=0 (평면이라 단순)
3. 변환 행렬 = 위치+방향 저장하는 4x4 표
4. 행렬 곱 = 경로 이어붙이기 (T02 = T01 * T12)
5. DH 쓰는 이유: 몇 Link든 같은 방식으로 확장 가능

#### s05_kinematics_jacobian.m - 자코비안 (야코비안 → 자코비안으로 통일)

**자코비안이란?**
```
ẋ = J * q̇  (순방향: 이론용)
q̇ = J⁻¹ * ẋ  (역방향: 실제 제어용) ⭐
```

**처음 이해: "관절 속도 주면 끝단 속도 알 수 있다"**
→ 맞지만 **실제로 더 중요한 건 반대 방향**

**실제 로봇 제어 흐름:**
1. 사용자: "끝점을 저기로 이동해"
2. 원하는 끝점 속도 (ẋ) 설정
3. q̇ = J⁻¹ * ẋ 로 관절 속도 계산
4. 모터에 속도 명령
5. 로봇 움직임

**IK vs 자코비안 헷갈렸던 것:**
- IK: "어디로 갈지" (위치 → 각도)
- 자코비안: "어떻게 갈지" (속도 제어)
- 특이점에서 둘 다 문제 생김

#### 특이점 (Singularity)

**det(J) = 0 의미:**
- det = determinant (디터미넌트, 행렬식)
- det(J) = 0 → J의 역행렬 존재 안 함 → 0으로 나누기 불가
- 기하학적: 면적이 0으로 찌그러짐 (□ → ─)

**특이점 = "특정 방향으로 못 움직임"**
```
팔 완전히 펴진 상태 (q2 ≈ 0°)
  ←  →  좌우 움직임: OK
    ↑↓  앞뒤 움직임: 불가능
```

**속도 타원 해석:**
- 동그란 타원 → 모든 방향 잘 움직임
- 찌그러진 타원 → 한 방향만 가능

**비유: 팔 쭉 펴고 손끝 더 멀리 밀기**
- 뇌: "손끝을 앞으로 1cm 더 보내려면 어깨랑 팔꿈치 어떻게?"
- 대답: "...어떻게 해도 방법 없음" = 특이점

**특이점 분석 그래프:**
- det(J) = L1 * L2 * sin(q2)
- sin(q2) = 0 되는 지점 = 특이점
- q2 = 0°, ±180° 에서 det(J) = 0

**시각화 그래프 점 의미:**
- ⚪ 하얀색 = 어깨 (위치 고정, q1 회전축)
- 🔴 빨간색 = 팔꿈치 (q2 회전축)
- 🟢 초록색 = 손끝 (끝점)
- 하늘색 타원 = 끝점이 움직일 수 있는 범위

### 260205 - 2-Link 기초 완료
- 2D Planar Robot 개념 이해 (X-Y 평면에서만 움직임)
- q1: 월드 기준 각도, q2: 링크1 기준 상대 각도
- Workspace = 도달 가능 영역 (도넛 모양: |L1-L2| ≤ r ≤ L1+L2)
- FK/IK 개념 확실히 이해
- RVCTools `transl()` 함수 사용 (T.t 대신)

---

## 다음 학습 계획

### s07_control 심화 (다음)
1. ~~PD/PID 제어~~ ✅
2. ~~중력보상 제어~~ ✅
3. 역동역학 기반 제어 (Computed Torque)
4. 임피던스/힘 제어

---

## MATLAB 시각화 규칙 (다크 테마)

**가시성 좋은 색상 (어두운 배경용)**
| 용도 | 색상 | RGB |
|------|------|-----|
| 링크1 | 노란색/주황 | `[1 0.8 0]` |
| 링크2 | 밝은 핑크 | `[1 0.4 0.7]` |
| 관절 | 빨강 | `'r'` |
| 궤적 | 초록 | `'g'` |
| 베이스 | 흰색 | `'w'` |
| 보조선 | 밝은 시안 | `[0.4 1 1]` |

**피해야 할 색상**: 파랑(`'b'`), 검정(`'k'`) - 다크 배경에서 안보임

---

## 유용한 MATLAB/RVCTools 명령어

```matlab
% 로봇 생성
L1 = Revolute('d', 0, 'a', 1, 'alpha', 0);
robot = SerialLink([L1 L2], 'name', '2-Link');

% FK
T = robot.fkine(q);
pos = transl(T);  % [x, y, z] 위치 추출

% IK
q = robot.ikine(T, 'mask', [1 1 0 0 0 0]);

% 시각화
robot.plot(q);
robot.teach();

% 동역학
tau = robot.rne(q, qd, qdd);   % 토크 계산 (한방)
M = robot.inertia(q);           % 질량 행렬
C = robot.coriolis(q, qd);      % 코리올리 행렬
g = robot.gravload(q);           % 중력 벡터
```

---

## 참고 자료 구조 (ref/)

```
Robotics_Learning/ref/
├── 1주차_setup/
├── 2주차_kinematics/
├── 3주차_dynamics/
├── 4주차_control/
├── 5주차_safety/
├── 6주차/
└── ojt.pptx
```

---

**마지막 업데이트**: 2026-02-09 (제어 기초, PD+중력보상, 게인 튜닝 학습 완료)
